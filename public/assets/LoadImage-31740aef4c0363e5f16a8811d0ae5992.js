(function(e){"use strict";var t=function(e,n,r){var i=document.createElement("img"),s,o;return i.onerror=n,i.onload=function(){o&&(!r||!r.noRevoke)&&t.revokeObjectURL(o),n(t.scale(i,r))},window.Blob&&e instanceof Blob||window.File&&e instanceof File?(s=o=t.createObjectURL(e),i._type=e.type):s=e,s?(i.src=s,i):t.readFile(e,function(e){i.src=e})},n=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;t.detectSubsampling=function(e){var t=e.width,n=e.height,r,i;return t*n>1048576?(r=document.createElement("canvas"),r.width=r.height=1,i=r.getContext("2d"),i.drawImage(e,-t+1,0),i.getImageData(0,0,1,1).data[3]===0):!1},t.detectVerticalSquash=function(e,t){var n=document.createElement("canvas"),r=n.getContext("2d"),i,s,o,u,a;n.width=1,n.height=t,r.drawImage(e,0,0),i=r.getImageData(0,0,1,t).data,s=0,o=t,u=t;while(u>s)a=i[(u-1)*4+3],a===0?o=u:s=u,u=o+s>>1;return u/t},t.renderImageToCanvas=function(e,n,r,i){var s=e.width,o=e.height,u=n.getContext("2d"),a,f=1024,l=document.createElement("canvas"),c,h,p,d,v;u.save(),t.detectSubsampling(e)&&(s/=2,o/=2),a=t.detectVerticalSquash(e,o),l.width=l.height=f,c=l.getContext("2d"),h=0;while(h<o){p=h+f>o?o-h:f,d=0;while(d<s)v=d+f>s?s-d:f,c.clearRect(0,0,f,f),c.drawImage(e,-d,-h),u.drawImage(l,0,0,v,p,Math.floor(d*r/s),Math.floor(h*i/o/a),Math.ceil(v*r/s),Math.ceil(p*i/o/a)),d+=f;h+=f}u.restore(),l=c=null},t.scale=function(e,n){n=n||{};var r=document.createElement("canvas"),i=e.width,s=e.height,o=Math.max((n.minWidth||i)/i,(n.minHeight||s)/s);return o>1&&(i=parseInt(i*o,10),s=parseInt(s*o,10)),o=Math.min((n.maxWidth||i)/i,(n.maxHeight||s)/s),o<1&&(i=parseInt(i*o,10),s=parseInt(s*o,10)),e.getContext||n.canvas&&r.getContext?(r.width=i,r.height=s,e._type==="image/jpeg"?t.renderImageToCanvas(e,r,i,s):r.getContext("2d").drawImage(e,0,0,i,s),r):(e.width=i,e.height=s,e)},t.createObjectURL=function(e){return n?n.createObjectURL(e):!1},t.revokeObjectURL=function(e){return n?n.revokeObjectURL(e):!1},t.readFile=function(e,t){if(window.FileReader&&FileReader.prototype.readAsDataURL){var n=new FileReader;return n.onload=function(e){t(e.target.result)},n.readAsDataURL(e),n}return!1},typeof define=="function"&&define.amd?define(function(){return t}):e.loadImage=t})(this);